function [rhsEF,rhsEE,rhsEJ,rhsEH,rhsHH,rhsHK,rhsHG,H0,K0] =form_mass_matrix(HH,KK,gRHS,f1RHS,f2RHS,Ex,Ey,Jx,Jy) globals2D; numel=(nelex)*(neley); one = ones(1,4); rhsEF=zeros(numed,1); % for (f,N_i) rhsEE=zeros(numed,1); % for (E0,N_i) rhsEJ=zeros(numed,1); % for (J0,N_i) rhsEH=zeros(numed,1); % for (H0,curl N_i) rhsHH=zeros(numel,1); % for (H0, psi_i) rhsHK=zeros(numel,1); % for (K0, psi_i) rhsHG=zeros(numel,1); % for (g, psi_i) % store the initial value at each element center H0 = zeros(numel,1); K0 = zeros(numel,1); matM = sparse(numed,numed); % zero matrix of numedges x numedges matBM = sparse(numed,numel); area = zeros(numel,1); for i=1:numel % coordinates of this element from 1st node & 3rd node xae=no2xy(1,el2no(1,i)); xbe=no2xy(1,el2no(3,i)); yae=no2xy(2,el2no(1,i)); ybe=no2xy(2,el2no(3,i)); midpt(i,1) = 0.5*(min(no2xy(1,el2no(:,i))) ... + max(no2xy(1,el2no(:,i)))); midpt(i,2) = 0.5*(min(no2xy(2,el2no(:,i))) ... + max(no2xy(2,el2no(:,i)))); H0(i) = HH(midpt(i,1),midpt(i,2),0); % element center value K0(i) = KK(midpt(i,1),midpt(i,2),0); % element center value rhs_g = gRHS(midpt(i,1),midpt(i,2),0.5*dt); % the coordinates of the four vertex xe(1)=xae; ye(1)=yae; xe(2)=xbe; ye(2)=yae; xe(3)=xbe; ye(3)=ybe; xe(4)=xae; ye(4)=ybe; area(i) = (ybe-yae)*(xbe-xae); % for non-uniform rectangles